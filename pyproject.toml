[project]
name = "nonebot-plugin-icey"
version = "0.1.4"
description = "Icey QQç¾¤ç®¡åŠ©æ‰‹"
readme = "README.md"
requires-python = ">=3.9, <4.0"
dependencies = [
    "nonebot2[fastapi]>=2.4.4",
    "nonebot2[httpx]>=2.4.4",
    "nonebot2[websockets]>=2.4.4",
    "nonebot-adapter-onebot>=2.4.6",
    "nonebot-adapter-telegram>=0.1.0b20",
    "nonebot-plugin-orm[mysql,postgresql,sqlite]>=0.8.3",
]

[project.optional-dependencies]
dev = ["pyright[nodejs]", "ruff"]

[tool.nonebot]
plugin_dirs = ["./plugins", "./src"]
builtin_plugins = []

[tool.nonebot.adapters]
nonebot-adapter-onebot = [
    { name = "OneBot V11", module_name = "nonebot.adapters.onebot.v11" },
]
nonebot-adapter-telegram = [
    { name = "Telegram", module_name = "nonebot.adapters.telegram" },
]
"@local" = []

[tool.nonebot.plugins]
"@local" = []
[tool.ruff]
line-length = 88
target-version = "py312"

[tool.ruff.format]
line-ending = "lf"

[tool.ruff.lint]
# For more rules, see https://docs.astral.sh/ruff/rules/.
select = [
    "F",     # Pyflakes
    "W",     # pycodestyle warnings
    "E",     # pycodestyle errors
    "I",     # isort
    "C90",   # mccabe
    "N",     # pep8-naming
    "PL",    # pylint
    "UP",    # pyupgrade
    "YTT",   # flake8-2020
    "ANN",   # flake8-annotations
    "ASYNC", # flake8-async
    "BLE",   # flake8-blind-except
    "FBT",   # flake8-boolean-trap
    "B",     # flake8-bugbear
    "A",     # flake8-builtins
    "COM",   # flake8-commas
    "C4",    # flake8-comprehensions
    "DTZ",   # flake8-datetimez
    "T10",   # flake8-debugger
    "ICN",   # flake8-import-conventions
    "PIE",   # flake8-pie
    "T20",   # flake8-print
    "PYI",   # flake8-pyi
    "Q",     # flake8-quotes
    "RSE",   # flake8-raise
    "RET",   # flake8-return
    "SIM",   # flake8-simplify
    "SLOT",  # flake8-slots
    "TID",   # flake8-tidy-imports
    "TC",    # flake8-type-checking
    "ARG",   # flake8-unused-arguments
    "PTH",   # flake8-use-pathlib
    # "ERA",   # eradicate
    "FAST", # FastAPI
    "PERF", # Perflint
    "PGH",  # pygrep-hooks
    "FURB", # refurb
    "TRY",  # tryceratops
    "RUF",  # Ruff-specific rules
]
ignore = [
    "E402",    # æ¨¡å—å¯¼å…¥ä¸åœ¨æ–‡ä»¶é¡¶éƒ¨ (NoneBot çš„ require éœ€è¦)
    "B008",    # å‡½æ•°é»˜è®¤å‚æ•°è°ƒç”¨ (Depends éœ€è¦)
    "UP037",   # å¼•ç”¨ç±»å‹æ³¨è§£
    "ANN202",  # ç§æœ‰å‡½æ•°ç¼ºå°‘è¿”å›ç±»å‹
    "ANN401",  # åŠ¨æ€ç±»å‹ Any
    "COM812",  # ç¼ºå°‘å°¾éšé€—å·
    "PLC0415", # é¡¶å±‚ä¹‹å¤–çš„å¯¼å…¥

    # === æœ¬æ¬¡æ–°å¢å¿½ç•¥ ===
    "ANN201",  # å…¬å…±å‡½æ•°ç¼ºå°‘è¿”å›ç±»å‹ (å¤ªç¹çï¼Œå¿½ç•¥)
    "BLE001",  # æ•è·é€šç”¨ Exception (Botå¼€å‘ä¸­å¸¸è§ï¼Œå¿½ç•¥)
    "TRY003",  # åœ¨ raise ä¸­åŒ…å«é•¿æ¶ˆæ¯ (å¿½ç•¥)
    "SIM103",  # ä¸éœ€è¦å¼ºåˆ¶ç®€åŒ– bool(x) è¿”å› (å¿½ç•¥)
    "TID252",  # å…è®¸ç›¸å¯¹å¯¼å…¥ (å…³é”®ï¼è§£å†³ä½ åˆšæ‰è¿è¡ŒæŠ¥é”™çš„é—®é¢˜)
    "ARG001",  # å…è®¸æœªä½¿ç”¨çš„å‚æ•° (Handler ä¸­å¸¸æœ‰ unused args)
    "SIM102",  # å…è®¸åµŒå¥— if
    "SIM105",  # å…è®¸ try-except-pass
    "PLR0912", # å…è®¸åˆ†æ”¯è¿‡å¤š
    "PIE810",  # å…è®¸åˆ†å¼€å†™ startswith
    "E501",    # å¿½ç•¥å•è¡Œä»£ç è¿‡é•¿
    "TC002",   # å¿½ç•¥ "æŠŠç¬¬ä¸‰æ–¹å¯¼å…¥ç§»åˆ°ç±»å‹æ£€æŸ¥å—ä¸­" çš„å»ºè®®
    "TRY301",  # å¿½ç•¥ "æŠŠ raise æŠ½è±¡åˆ°å†…éƒ¨å‡½æ•°" çš„å»ºè®®

    # === ğŸš¨ é’ˆå¯¹ CI æŠ¥é”™å¿…é¡»è¡¥å…¨çš„å¿½ç•¥é¡¹ (ç¼ºäº†è¿™äº› CI ä¼šæŒ‚) ===
    "UP047",   # æ³›å‹å‡½æ•°åº”ä½¿ç”¨ç±»å‹å‚æ•°
    "ANN003",  # **kwargs ç¼ºå°‘ç±»å‹æ³¨è§£
    "UP035",   # å…è®¸ä½¿ç”¨ typing.Dict/List (æ—§å†™æ³•)
    "UP036",   # ç‰ˆæœ¬æ£€æŸ¥ä»£ç è¿‡æ—¶
    "RUF012",  # ç±»å±æ€§ç¼ºå°‘ ClassVar æ³¨è§£
    "ANN206",  # classmethod ç¼ºå°‘è¿”å›ç±»å‹
    "PTH123",  # open() vs Path.open()
    "C901",    # å‡½æ•°å¤æ‚åº¦è¿‡é«˜ (McCabe)
    "PLR0915", # å‡½æ•°è¯­å¥è¿‡å¤š
    "PLW2901", # å¾ªç¯å˜é‡è¢«è¦†ç›–
    "T201",    # ä»£ç ä¸­æ®‹ç•™ print (CI ä¸å…è®¸ print)
    "ANN001",  # å‡½æ•°å‚æ•°ç¼ºå°‘ç±»å‹æ³¨è§£
    "N806",    # å˜é‡å‘½åä¸è§„èŒƒ (å¦‚ _Fake)
    "F401",    # å¯¼å…¥ä½†æœªä½¿ç”¨
]
allowed-confusables = [
    "ï¼Œ",
    "ã€‚",
    "â€œ",
    "â€",
    "ï¼š",
    "ï¼›",
    "ï¼Ÿ",
    "ï¼",
    "ã€",
    "ã€‘",
    "ã€Š",
    "ã€‹",
    "â€¦",
    "â€”",
    "ï¼ˆ",
    "ï¼‰",
    "ã€",
]

[tool.ruff.lint.pyupgrade]
keep-runtime-typing = true

[tool.pyright]
# For Pylance/Pyright configurations, see https://microsoft.github.io/pyright/#/configuration.
pythonVersion = "3.12"
pythonPlatform = "All"
typeCheckingMode = "standard"


[tool.ruff.lint.per-file-ignores]
# å¿½ç•¥æ‰€æœ‰ __init__.py æ–‡ä»¶ä¸­çš„ "æ¨¡å—å¯¼å…¥ä¸åœ¨é¡¶éƒ¨" é”™è¯¯
# "__init__.py" = ["E402", "F401"] 

# æˆ–è€…ä»…é’ˆå¯¹ç‰¹å®šæ–‡ä»¶
"./src/nonebot_plugin_icey/__init__.py" = ["E402"]


[tool.bumpversion]
# commit_args = "--no-verify" 
current_version = "0.1.4"
commit = true
message = "release: bump version from {current_version} to {new_version}"
tag = true

# é…ç½® 1: æ›´æ–° pyproject.toml é‡Œçš„ç‰ˆæœ¬å·
[[tool.bumpversion.files]]
filename = "pyproject.toml"
# åªæŸ¥æ‰¾ version å­—æ®µï¼Œè¿™æ ·å®¹é”™ç‡æ›´é«˜
search = "version = \"{current_version}\""
replace = "version = \"{new_version}\""

# é…ç½® 2: (å¯é€‰) å¦‚æœä½ çš„ __init__.py é‡Œä¹Ÿæœ‰ç‰ˆæœ¬å·ï¼Œå–æ¶ˆä¸‹é¢çš„æ³¨é‡Šå¹¶ä¿®æ”¹è·¯å¾„
[[tool.bumpversion.files]]
filename = "src/nonebot_plugin_icey/__init__.py"
search = "__version__ = \"{current_version}\""
replace = "__version__ = \"{new_version}\""

# === æ–°å¢ï¼šè®© bumpversion è‡ªåŠ¨ä¿®æ”¹ uv.lock ===
[[tool.bumpversion.files]]
filename = "uv.lock"
search = "name = \"nonebot-plugin-icey\"\nversion = \"{current_version}\""
replace = "name = \"nonebot-plugin-icey\"\nversion = \"{new_version}\""

[tool.poe.tasks]
bump = "bump-my-version bump"


# â¯ uv tool list
# bump-my-version v1.2.6
# - bump-my-version
# nb-cli v1.6.0
# - nb
# pip v25.3
# - pip
# - pip3
# - pip3.12
# poethepoet v0.40.0
# - poe
# ruff v0.14.11
# - ruff
